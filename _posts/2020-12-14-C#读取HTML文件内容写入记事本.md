---
layout:     post
title:      C#读取HTML文件内容写入记事本
subtitle:   
date:       2020-12-14
author:     coderidea
header-style: text
catalog: true
tags:
- 程序人生
- 网站设计
- 企业架构
--- 
<div class="postBody">
			<div id="cnblogs_post_body" class="blogpost-body"><h1><span class="Apple-style-span" style="font-family:Arial;font-weight:bold;line-height:18px;">C#读取HTML文件内容写入记事本</span></h1>
<p><span class="Apple-style-span" style="font-family:Arial;font-weight:bold;line-height:18px;"><br /></span></p>
<p></p>
<div class="cnblogs_code">
<pre><span style="color:#0000ff;">try</span><br />            {<br /><span style="color:#0000ff;">int</span> totalFile = <span style="color:#800080;">0</span>;<br /><span style="color:#008000;">//</span><span style="color:#008000;">string dirPath = @"E:\chfuMetarnet\BSC6810 alarm\";</span><span style="color:#008000;"><br /></span>                <span style="color:#0000ff;">if</span> (<span style="color:#0000ff;">this</span>.textBox1.Text.Trim() == <span style="color:#800000;">""</span>)<br />                {<br />                    MessageBox.Show(<span style="color:#800000;">"</span><span style="color:#800000;">请输入HTML文件路径！</span><span style="color:#800000;">"</span>);<br />                }<br /><span style="color:#0000ff;">else</span><br />                {<br /><span style="color:#0000ff;">string</span> dirPath = <span style="color:#0000ff;">this</span>.textBox1.Text.Trim();<br /><span style="color:#0000ff;">if</span> (!dirPath.Substring(dirPath.Length - <span style="color:#800080;">1</span>).Contains(<span style="color:#800000;">"</span><span style="color:#800000;">\\</span><span style="color:#800000;">"</span>))<br />                    {<br />                        dirPath = dirPath+<span style="color:#800000;">"</span><span style="color:#800000;">\\</span><span style="color:#800000;">"</span>;<br />                    }<br />                    StreamWriter sw;<br />                    DirectoryInfo dirInfo = <span style="color:#0000ff;">new</span> DirectoryInfo(dirPath);<br />                    FileInfo[] files = dirInfo.GetFiles();<br /><span style="color:#0000ff;">string</span> filename = dirPath + <span style="color:#800000;">"</span><span style="color:#800000;">告警经验库信息.txt</span><span style="color:#800000;">"</span>;<br /><span style="color:#0000ff;">if</span> (File.Exists(filename))<br />                    {<br />                        sw = File.AppendText(filename);<br />                    }<br /><span style="color:#0000ff;">else</span><br />                    {<br />                        sw = File.CreateText(filename);<br />                    }<br /><span style="color:#0000ff;">foreach</span> (FileInfo fileinfo <span style="color:#0000ff;">in</span> files)<br />                    {<br /><span style="color:#0000ff;">if</span> (fileinfo.Extension.Equals(<span style="color:#800000;">"</span><span style="color:#800000;">.htm</span><span style="color:#800000;">"</span>))<span style="color:#008000;">//</span><span style="color:#008000;">遍历所有htm文件</span><span style="color:#008000;"><br /></span>                        {<br />                            totalFile = totalFile + <span style="color:#800080;">1</span>;<br />                            WebRequest myWebRequest = WebRequest.Create(dirPath + fileinfo.Name);<br />                            WebResponse myWebResponse = myWebRequest.GetResponse();<br />                            Stream myStream = myWebResponse.GetResponseStream();<br />                            Encoding encode = System.Text.Encoding.GetEncoding(<span style="color:#800000;">"</span><span style="color:#800000;">gb2312</span><span style="color:#800000;">"</span>);<br />                            StreamReader myStreamReader = <span style="color:#0000ff;">new</span> StreamReader(myStream, encode);<br /><span style="color:#0000ff;">string</span> strhtml = myStreamReader.ReadToEnd();<br />                            myWebResponse.Close();<br /><span style="color:#0000ff;">string</span> stroutput = strhtml;<br />                            Regex regex = <span style="color:#0000ff;">new</span> Regex(<span style="color:#800000;">@"</span><span style="color:#800000;">&lt;[^&gt;]+&gt;|&lt;/[^&gt;]+&gt;</span><span style="color:#800000;">"</span>);<span style="color:#008000;">//</span><span style="color:#008000;">去掉HTML标记的正则表达式</span><span style="color:#008000;"><br /></span>                            <span style="color:#0000ff;">string</span> tmpStr = <span style="color:#800000;">"</span><span style="color:#800000;">&lt;h4&gt;([^&lt;]*)&lt;/h4&gt;</span><span style="color:#800000;">"</span>;        <span style="color:#008000;">//</span><span style="color:#008000;">获取&lt;h4&gt;之间内容的表达式</span><span style="color:#008000;"><br /></span>                            Match TitleMatch = Regex.Match(strhtml, tmpStr, RegexOptions.IgnoreCase | RegexOptions.Multiline);<br /><span style="color:#0000ff;">string</span> causename = TitleMatch.Value.ToString();<span style="color:#008000;">//</span><span style="color:#008000;">包含&lt;h4&gt;和&lt;/h4&gt;标记</span><span style="color:#008000;"><br /></span>                            causename = Regex.Replace(causename, <span style="color:#800000;">"</span><span style="color:#800000;">[\n|\r|\t]</span><span style="color:#800000;">"</span>, <span style="color:#800000;">"</span><span style="color:#800000;"> </span><span style="color:#800000;">"</span>);<span style="color:#008000;">//</span><span style="color:#008000;">去掉换行和TAB键符号</span><span style="color:#008000;"><br /></span>                            causename = causename.Trim();<br /><span style="color:#0000ff;">string</span> cause = causename.Substring(<span style="color:#800080;">4</span>, causename.Length - <span style="color:#800080;">9</span>);<span style="color:#008000;">//</span><span style="color:#008000;">得到告警原因</span><span style="color:#008000;"><br /></span>                            <span style="color:#0000ff;">string</span> titleStr = <span style="color:#800000;">"</span><span style="color:#800000;">&lt;title&gt;([^&lt;]*)&lt;/title&gt;</span><span style="color:#800000;">"</span>;<br />                            TitleMatch = Regex.Match(strhtml, titleStr, RegexOptions.IgnoreCase | RegexOptions.Multiline);<br /><span style="color:#0000ff;">string</span> titlename = TitleMatch.Value.ToString();<br />                            titlename = Regex.Replace(titlename, <span style="color:#800000;">"</span><span style="color:#800000;">[\n|\r|\t]</span><span style="color:#800000;">"</span>, <span style="color:#800000;">""</span>);<span style="color:#008000;">//</span><span style="color:#008000;">去掉换行和TAB键符号</span><span style="color:#008000;"><br /></span>                            titlename = titlename.Trim();<br /><span style="color:#0000ff;">string</span> regexStr = <span style="color:#800000;">"</span><span style="color:#800000;">&lt;ul&gt;&lt;li&gt;(?&lt;key&gt;.*?)&lt;/ul&gt;</span><span style="color:#800000;">"</span>;<span style="color:#008000;">//</span><span style="color:#008000;">获取&lt;ul&gt;&lt;li&gt;后边的内容，直到&lt;/ul&gt;结尾</span><span style="color:#008000;"><br /></span>                            Regex r = <span style="color:#0000ff;">new</span> Regex(regexStr, RegexOptions.None);<br />                            strhtml = Regex.Replace(strhtml, <span style="color:#800000;">"</span><span style="color:#800000;">[\n|\r|\t]</span><span style="color:#800000;">"</span>, <span style="color:#800000;">""</span>);<span style="color:#008000;">//</span><span style="color:#008000;">去掉换行和TAB键符号</span><span style="color:#008000;"><br /></span>                            Match mc = r.Match(strhtml);<br /><span style="color:#0000ff;">string</span> dataStr = mc.Groups[<span style="color:#800000;">"</span><span style="color:#800000;">key</span><span style="color:#800000;">"</span>].Value;<br />                            dataStr = <span style="color:#800000;">"</span><span style="color:#800000;">&lt;ul&gt;&lt;li&gt;</span><span style="color:#800000;">"</span> + dataStr + <span style="color:#800000;">"</span><span style="color:#800000;">&lt;/ul&gt;</span><span style="color:#800000;">"</span>;<span style="color:#008000;">//</span><span style="color:#008000;">得到完整的&lt;ul&gt;&lt;/ul&gt;之间的源码</span><span style="color:#008000;"><br /></span>                            strhtml = strhtml.Replace(dataStr, <span style="color:#800000;">""</span>);<span style="color:#008000;">//</span><span style="color:#008000;">将去掉换行符和tab键的源码中去除&lt;ul&gt;&lt;/ul&gt;部分源码</span><span style="color:#008000;"><br /></span>                            strhtml = strhtml.Replace(titlename, <span style="color:#800000;">""</span>);<span style="color:#008000;">//</span><span style="color:#008000;">去掉&lt;title&gt;&lt;/title&gt;</span><span style="color:#008000;"><br /></span>                            strhtml = regex.Replace(strhtml, <span style="color:#800000;">"</span><span style="color:#800000;"> </span><span style="color:#800000;">"</span>);<span style="color:#008000;">//</span><span style="color:#008000;">过滤掉HTML标记</span><span style="color:#008000;"><br /></span>                            strhtml = strhtml.Replace(<span style="color:#800000;">"</span><span style="color:#800000;">&amp;nbsp;</span><span style="color:#800000;">"</span>, <span style="color:#800000;">""</span>);<span style="color:#008000;">//</span><span style="color:#008000;">去掉空格字符</span><span style="color:#008000;"><br /></span>                            <span style="color:#0000ff;">string</span>[] arr = cause.Split(<span style="color:#800000;">'</span><span style="color:#800000;"> </span><span style="color:#800000;">'</span>);<br /><span style="color:#0000ff;">string</span> zhCause = arr[arr.Length - <span style="color:#800080;">1</span>];<span style="color:#008000;">//</span><span style="color:#008000;">获取数组最后一个元素：告警原因</span><span style="color:#008000;"><br /></span>                            sw.WriteLine(<span style="color:#800000;">"</span><span style="color:#800000;">第</span><span style="color:#800000;">"</span> + totalFile + <span style="color:#800000;">"</span><span style="color:#800000;">个文件：</span><span style="color:#800000;">"</span> + fileinfo.Name);<br />                            sw.WriteLine(<span style="color:#800000;">"</span><span style="color:#800000;">-----告警原因------：</span><span style="color:#800000;">"</span>);<br /><span style="color:#008000;">//</span><span style="color:#008000;">sw.WriteLine(cause);</span><span style="color:#008000;">//</span><span style="color:#008000;"> ALM-1 网元启动</span><span style="color:#008000;"><br /></span>                            zhCause=<span style="color:#0000ff;">this</span>.chinaString(zhCause);<br />                            sw.WriteLine(zhCause);<span style="color:#008000;">//</span><span style="color:#008000;">网元启动</span><span style="color:#008000;"><br /></span>                            sw.WriteLine(<span style="color:#800000;">"</span><span style="color:#800000;">-----处理经验------：</span><span style="color:#800000;">"</span>);<br />                            sw.WriteLine(strhtml);<br />                            sw.WriteLine();<br />                            sw.Flush();<br /><br />                        }<br />                    }<br />                    sw.Close();<br />                    MessageBox.Show(<span style="color:#800000;">"</span><span style="color:#800000;">操作成功！</span><span style="color:#800000;">"</span>, <span style="color:#800000;">"</span><span style="color:#800000;">提示</span><span style="color:#800000;">"</span>, MessageBoxButtons.OK, MessageBoxIcon.Information);<br />                }<br />            }<br /><span style="color:#0000ff;">catch</span> (Exception ee)<br />            {<br />                MessageBox.Show(<span style="color:#800000;">"</span><span style="color:#800000;">操作失败：</span><span style="color:#800000;">"</span> + ee.Message);<br />            }</pre>
</div>
<p>


</p></div><div id="MySignature"></div>
<div class="clear"></div>
<div id="blog_post_info_block">
<div id="BlogPostCategory"></div>
<div id="EntryTag"></div>
<div id="blog_post_info">
</div>
<div class="clear"></div>
<div id="post_next_prev"></div>
</div>


		</div>
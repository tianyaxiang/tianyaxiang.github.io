---
layout:     post
title:      C#正则表达式匹配HTML中的图片路径，图片地址
subtitle:   
date:       2020-5-25
author:     Coderidea
header-style: text
catalog: true
tags:
- 程序人生
- C#
--- 
<div class="postBody">
			<div id="cnblogs_post_body" class="blogpost-body"><p>C#<strong>正则</strong>表达式匹配HTML中的<strong>图片路径</strong>，<strong>图片地址</strong></p>
<p><span class="Apple-style-span" style="font-family:Arial, '宋体';font-size:14px;line-height:25px;"><span style="font-size:12px;">       最近的项目中有个关于网页取图的功能需要我自己开发，那就是用正则表达式来匹配图片标签。<br /></span><span style="font-size:12px;">      一般来说一个 HTML 文档有很多标签，比如“<span style="color:#0000ff;">&lt;</span><span style="color:#800000;">html</span><span style="color:#0000ff;">&gt;</span>”、“<span style="color:#0000ff;">&lt;</span><span style="color:#800000;">body</span><span style="color:#0000ff;">&gt;</span>”、“<span style="color:#0000ff;">&lt;</span><span style="color:#800000;">table</span><span style="color:#0000ff;">&gt;</span>”等，想把文档中的 <strong>img 标签</strong>提取出来并不是一件容易的事。由于<strong><span style="color:#888888;"> img 标签</span></strong>样式变化多端，使提取的时候用程序寻找并不容易。于是想要寻找它们就必须写一个非常健全的正则表达式，不然有可能会找得不全，或者找出来的不是正确的<strong> img 标签</strong>。</span><br /><span style="font-size:12px;">我们可以从 HTML 标签的格式去想应该怎么建这个<strong>正则表达式</strong>。首先要想一下<strong> img 标签</strong>有几种写法，忽略大小写不看的话，下面列出<strong> img 标签</strong>可能出现的几种情况。</span><br /><span style="font-size:12px;"><span style="color:#0000ff;">&lt;</span><span style="color:#800000;">img</span><span style="color:#0000ff;">&gt; &lt;</span><span style="color:#800000;">img</span><span style="color:#0000ff;">/&gt; &lt;</span><span style="color:#800000;">img</span> <span style="color:#ff0000;">src</span><span style="color:#0000ff;">=/&gt;</span><br />这一些标签不用考虑，因为没有图片资源地址。</span><br /><span style="font-size:12px;"><span style="color:#0000ff;">&lt;</span><span style="color:#800000;">img</span> <span style="color:#ff0000;">src</span> <span style="color:#0000ff;">= /images/pic.jpg/ &gt; &lt;</span><span style="color:#800000;">img</span> <span style="color:#ff0000;">src</span> <span style="color:#0000ff;">=" /images/pic.jpg" &gt; &lt;</span><span style="color:#800000;">img</span> <span style="color:#ff0000;">src</span><span style="color:#0000ff;">= '/images/pic.jpg ' / &gt;</span><br />这一些标签都有图片资源地址，另外还有一个特点就是有引号对，可能为单引号，也可能为双引号。因为不需要同时匹配引号对，所以正则表达式可以这么写：@"&lt;img\s*src\s*=\s*[""']?\s*(?[^\s""'&lt;&gt;]*)\s*/?\s*&gt;"</span><br /><span style="font-size:12px;"><span style="color:#0000ff;">&lt;</span><span style="color:#800000;">img</span> <span style="color:#ff0000;">width</span><span style="color:#0000ff;">="320"</span> <span style="color:#ff0000;">height</span><span style="color:#0000ff;">="240"</span> <span style="color:#ff0000;">src</span><span style="color:#0000ff;">=/images/pic.jpg</span> <span style="color:#ff0000;">onclick</span><span style="color:#0000ff;">="window.open('/images/pic.jpg')"&gt;</span><br />因为 img 和 src 之间可能会有其他的参数，所以“<span style="color:#0000ff;">&lt;</span><span style="color:#800000;">img</span>”要有个单词结束，比如说不能是“<span style="color:#0000ff;">&lt;</span><span style="color:#800000;">imgabc</span>”，同样 src 前面也是一样，使用单词结束符“\b”有一个好处就是省去了表示空格的“\s*”。另外由于 img 标签中不可以出现“<span style="color:#0000ff;">&lt;</span>”、“<span style="color:#0000ff;">&gt;</span>”这样的符号，所以要改写前面的正则表达式：@"&lt;img\b[^&lt;&gt;]*?\bsrc\s*=\s*[""']?\s*(?&lt;imgUrl&gt;[^\s""'&lt;&gt;]*)[^&lt;&gt;]*?/?\s*&gt;"</span><br /><span style="font-size:12px;"><span style="color:#0000ff;">&lt;</span><span style="color:#800000;">img</span> <span style="color:#ff0000;">width</span><span style="color:#0000ff;">="320"</span> <span style="color:#ff0000;">height</span><span style="color:#0000ff;">="240"</span> <span style="color:#ff0000;">src</span> <span style="color:#0000ff;">= "</span><br /><span style="color:#0000ff;">/images/pic.jpg" /&gt;</span><br />像这种可能会用回车符折行的问题有时候会出现，所以在有空格分开的地方要包含回车换行和 TAB 字符，另外在图片地址中不能出现空格、TAB、回车和换行字符。所以上面的<strong>正则表达式</strong>可以改成：@"&lt;img\b[^&lt;&gt;]*?\bsrc[\s\t\r\n]*=[\s\t\r\n]*[""']?[\s\t\r\n]*(?&lt;imgUrl&gt;[^\s\t\r\n""'&lt;&gt;]*)[^&lt;&gt;]*?/?[\s\t\r\n]*&gt;"</span><br /><span style="font-size:12px;">下面写出取得HTML中所有图片地址的静态方法。</span></span></p>
<div class="cnblogs_code">
<pre>        <span style="color:#808080;">///</span><span style="color:#808080;">&lt;summary&gt;</span><span style="color:#008000;"><br /></span><span style="color:#808080;">///</span><span style="color:#008000;"> 取得HTML中所有图片的 URL。<br /></span><span style="color:#808080;">///</span><span style="color:#808080;">&lt;/summary&gt;</span><span style="color:#008000;"><br /></span><span style="color:#808080;">///</span><span style="color:#808080;">&lt;param name="sHtmlText"&gt;</span><span style="color:#008000;">HTML代码</span><span style="color:#808080;">&lt;/param&gt;</span><span style="color:#008000;"><br /></span><span style="color:#808080;">///</span><span style="color:#808080;">&lt;returns&gt;</span><span style="color:#008000;">图片的URL列表</span><span style="color:#808080;">&lt;/returns&gt;</span><span style="color:#808080;"><br /></span>        <span style="color:#0000ff;">public</span> <span style="color:#0000ff;">static</span> <span style="color:#0000ff;">string</span>[] GetHtmlImageUrlList(<span style="color:#0000ff;">string</span> sHtmlText)<br />        {<br /><span style="color:#008000;">//</span><span style="color:#008000;"> 定义正则表达式用来匹配 img 标签</span><span style="color:#008000;"><br /></span>            Regex regImg = <span style="color:#0000ff;">new</span> Regex(<span style="color:#800000;">@"</span><span style="color:#800000;">&lt;img\b[^&lt;&gt;]*?\bsrc[\s\t\r\n]*=[\s\t\r\n]*[""']?[\s\t\r\n]*(?&lt;imgUrl&gt;[^\s\t\r\n""'&lt;&gt;]*)[^&lt;&gt;]*?/?[\s\t\r\n]*&gt;</span><span style="color:#800000;">"</span>, RegexOptions.IgnoreCase);<br /><br /><span style="color:#008000;">//</span><span style="color:#008000;"> 搜索匹配的字符串</span><span style="color:#008000;"><br /></span>            MatchCollection matches = regImg.Matches(sHtmlText);<br /><br /><span style="color:#0000ff;">int</span> i = <span style="color:#800080;">0</span>;<br /><span style="color:#0000ff;">string</span>[] sUrlList = <span style="color:#0000ff;">new</span> <span style="color:#0000ff;">string</span>[matches.Count];<br /><br /><span style="color:#008000;">//</span><span style="color:#008000;"> 取得匹配项列表</span><span style="color:#008000;"><br /></span>            <span style="color:#0000ff;">foreach</span> (Match match <span style="color:#0000ff;">in</span> matches)<br />                sUrlList[i++] = match.Groups[<span style="color:#800000;">"</span><span style="color:#800000;">imgUrl</span><span style="color:#800000;">"</span>].Value;<br /><br /><span style="color:#0000ff;">return</span> sUrlList;<br />        }</pre>
</div>
<p id="PSignature" style="line-height:20px;background:#FFFAEA no-repeat 2% 50%;font-size:12px;border:#e0e0e0 1px dashed;"><img title="web馆" src="/img/wx.gif" alt="" width="113" height="113" /><br />  欢迎扫描此二维码关注web馆公众号  <br />  作者：<a href="https://www.leti.ltd/">web馆</a>  <br />  出处：<a href="http://www.cnblogs.com/xiaoyao2011">https://www.leti.ltd/</a> <br />  欢迎任何形式的转载，但请务必注明出处。<br /><br /><br /></p>
<p> </p></div><div id="MySignature"></div>
<div class="clear"></div>
<div id="blog_post_info_block">
<div id="BlogPostCategory"></div>
<div id="EntryTag"></div>
<div id="blog_post_info">
</div>
<div class="clear"></div>
<div id="post_next_prev"></div>
</div>


		</div>